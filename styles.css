/* ========= 基本トークン ========= */
:root{
  --bg:          light-dark(#fafafa, #0f1115);
  --card:        light-dark(#ffffff, #141820);
  --text:        light-dark(#111, #e9eef3);
  --muted:       light-dark(#5f6b7a, #9fb0c3);
  --accent:      #3b82f6;
  --accent-2:    #22c55e;
  --danger:      #ef4444;

  --board-green: #2f7d32;
  --board-dark:  #2a6b2c;

  /* 盤まわり（デスクトップのデフォルト） */
  --gap:         6px;
  --cell-size:   60px; /* 8*60 + 9*6 = 534px */
  --board-size:  calc(8*var(--cell-size) + 9*var(--gap));

  /* 評価バーの基準幅（デスクトップ） */
  --eval-w:      52px;

  /* レイアウトの水平パディング（上書き可能） */
  --layout-hpad: 18px;
}

*{ box-sizing: border-box; -webkit-tap-highlight-color: transparent }
html,body{ height: 100% }
body{
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
  background: var(--bg);
  color: var(--text);
  /* 万一のはみ出しを殺す（丸め誤差対策） */
  overflow-x: hidden;
}

/* ========= ヘッダ ========= */
.topbar{
  display:flex; align-items:center; justify-content:space-between;
  padding: 14px 16px; border-bottom: 1px solid color-mix(in oklab, var(--text) 12%, transparent);
  position: sticky; top:0; backdrop-filter: blur(8px);
}
.topbar h1{ margin:0; font-size: 22px; letter-spacing: .5px; }
.badges{ display:flex; gap:8px }
.badge{ font-size:12px; padding:2px 8px; border-radius:999px; background:color-mix(in oklab, var(--accent) 20%, transparent); }

/* ========= レイアウト ========= */
.layout{
  display:grid; grid-template-columns: 1fr 360px; gap: 18px;
  padding: 18px var(--layout-hpad);
  max-width: 1200px; margin: 0 auto;
}
@media (max-width: 980px){
  .layout{ grid-template-columns: 1fr; gap: 14px; }
}

/* iPhone のセーフエリア対応（ノッチ等） */
@supports (padding: max(0px)){
  .layout{
    padding-left:  max(var(--layout-hpad), env(safe-area-inset-left));
    padding-right: max(var(--layout-hpad), env(safe-area-inset-right));
  }
}

.board-wrap{
  display:flex; gap:14px; align-items:flex-start; justify-content:center;
}

/* ========= 盤とラッパ ========= */
.board-box{
  position: relative;
  width: max-content;
  height: max-content;
}

.board{
  display:grid;
  grid-template-columns: repeat(8, var(--cell-size));
  grid-auto-rows: var(--cell-size);
  gap: var(--gap);
  background: var(--board-green);
  padding: var(--gap);
  border-radius: 14px;
  box-shadow: inset 0 8px 32px rgba(0,0,0,.25), 0 14px 30px rgba(0,0,0,.15);
  width: max-content;
  touch-action: manipulation;
}

.cell{
  position: relative;
  width: var(--cell-size); height: var(--cell-size);
  background: var(--board-dark);
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,.08);
  cursor: pointer; outline: none;
  transition: transform .05s ease;
  min-width: 44px; min-height: 44px;
}
.cell:active{ transform: translateY(1px) }
.cell:focus-visible{ box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent) 40%, transparent) }

.stone{
  position:absolute; inset: 8px; border-radius:50%;
  box-shadow: 0 3px 8px rgba(0,0,0,.4), inset 0 2px 5px rgba(255,255,255,.18);
  transform: scale(.9); opacity: 0; animation: pop .12s ease forwards;
}
.stone.black{ background: #0e0f11; }
.stone.white{ background: #e9eef3; }

@keyframes pop{ to{ transform: scale(1); opacity: 1 } }

.hint{
  position:absolute; inset: calc(50% - 4px);
  width: 8px; height: 8px; border-radius:50%;
  background: rgba(255,255,255,.85);
  mix-blend-mode: difference; opacity:.55; pointer-events:none;
}

.lastmove{
  outline: 3px solid color-mix(in oklab, var(--accent-2) 60%, transparent);
  outline-offset: -3px;
}

/* ========= 評価バー（幅を変数化） ========= */
.evalbar{
  position:relative; width: var(--eval-w);
  height: calc(8*var(--cell-size) + 2*var(--gap) + 2*var(--gap));
  border-radius: 10px; overflow:hidden; background: #111;
  box-shadow: inset 0 4px 14px rgba(0,0,0,.5);
}
#evalFill{
  position:absolute; left:0; bottom:0; width:100%; height:50%;
  background: linear-gradient(to top, #0e0f11, #4ade80);
  transition: height .2s ease;
}
.evallabels{
  position:absolute; inset: 6px 4px;
  display:flex; flex-direction:column; justify-content:space-between; align-items:stretch;
  pointer-events:none;
  color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,.6);
  z-index: 1;
  font-size: clamp(11px, calc(var(--eval-w) * 0.28), 16px);
}
.evallabels .label{
  display:flex; align-items:center; justify-content:space-between; gap:6px;
  width: 100%;
  white-space: nowrap;
}
.count{
  pointer-events:auto;
  padding: 2px 6px; border-radius: 999px; font-weight: 800;
  box-shadow: 0 1px 2px rgba(0,0,0,.4);
}
.count.white{ background:#e9eef3; color:#0e0f11; }
.count.black{ background:#0e0f11; color:#e9eef3; }

/* ========= オーバーレイ（パス／結果） ========= */
.overlay{
  position:absolute; inset: 0;
  display:flex; align-items:center; justify-content:center;
  background: color-mix(in oklab, #000 45%, transparent);
  backdrop-filter: blur(2px);
  opacity: 0; pointer-events: none;
  transition: opacity .18s ease;
}
.overlay.show{ opacity: 1; pointer-events: auto; }
.overlay.hidden{ display: none; }

.overlay-card{
  background: var(--card);
  color: var(--text);
  border: 1px solid color-mix(in oklab, var(--text) 14%, transparent);
  border-radius: 16px;
  min-width: 240px;
  max-width: 90vw;
  padding: 18px 16px;
  text-align: center;
  box-shadow: 0 20px 40px rgba(0,0,0,.35);
}
.overlay-card h2{
  margin: 0 0 8px; font-size: 24px; letter-spacing: .5px;
}
.overlay-card p{
  margin: 6px 0; color: var(--muted);
}
.overlay-actions{ display:flex; gap:10px; justify-content:center; margin-top: 12px; }
.overlay-actions button{
  padding: 10px 14px; border-radius: 10px; border: none;
  background: color-mix(in oklab, var(--accent) 20%, transparent);
  color: var(--text); font-weight: 700; cursor: pointer;
  border:1px solid color-mix(in oklab, var(--accent) 35%, transparent);
}
.overlay-actions .danger{
  background: color-mix(in oklab, var(--danger) 22%, transparent);
  border-color: color-mix(in oklab, var(--danger) 40%, transparent);
}

/* ========= 右サイド ========= */
.side{ display:flex; flex-direction:column; gap:14px; }

.status{
  padding: 10px 12px; border-radius: 12px;
  background: var(--card); border: 1px solid color-mix(in oklab, var(--text) 12%, transparent);
  font-weight: 600;
}

.card{
  background: var(--card);
  border: 1px solid color-mix(in oklab, var(--text) 12%, transparent);
  border-radius: 14px; padding: 12px;
  display:flex; flex-direction:column; gap:10px;
}

.row{ display:flex; gap:10px; align-items:center; justify-content:space-between; }
.row label{ font-size: 14px; color: var(--muted); }
.row select, .row input[type="range"]{ width: 180px; }
.toggles{ justify-content:flex-start; gap:18px; flex-wrap: wrap; }

.buttons{ display:flex; flex-wrap:wrap; gap:8px; }
button{
  appearance:none; border:none; border-radius: 10px; padding: 10px 14px;
  background: color-mix(in oklab, var(--accent) 20%, transparent);
  color: var(--text); cursor:pointer; font-weight:600;
  border:1px solid color-mix(in oklab, var(--accent) 35%, transparent);
  transition: transform .05s ease, background .2s ease;
  min-height: 44px;
}
button:hover{ transform: translateY(-1px) }
button:disabled{ opacity:.5; cursor:not-allowed; transform:none }
button.danger{
  background: color-mix(in oklab, var(--danger) 24%, transparent);
  border-color: color-mix(in oklab, var(--danger) 40%, transparent);
}

.help{ margin:0; color: var(--muted); font-size: 13px }
code{ background: color-mix(in oklab, var(--text) 10%, transparent); padding:2px 6px; border-radius:6px }

.moves{ margin:0; padding-left: 20px; max-height: 220px; overflow:auto; }
.moves li{ padding: 2px 0; color: var(--muted) }
.moves-actions{ display:flex; gap:8px }
.moves-actions button{ padding:6px 8px; font-size:13px }

.foot{ text-align:center; padding: 20px 10px; color: var(--muted) }

/* ========= スマホ最適化 ========= */
@media (max-width: 720px){
  :root{
    /* モバイルの左右パディングと、board-wrap の隙間を変数化 */
    --layout-hpad: 10px;
    --wrap-gap: 8px;

    /* 評価バー幅を端末幅に応じて可変化（40–56px） */
    --eval-w: clamp(40px, 12vw, 56px);

    /* 盤サイズを「画面幅 − 左右パディング − 評価バー − wrap隙間」で算出 */
    --board-size: min(
      calc(100vw - (2 * var(--layout-hpad)) - var(--eval-w) - var(--wrap-gap)),
      480px
    );

    --gap: 4px;
    --cell-size: calc((var(--board-size) - 9*var(--gap)) / 8);
  }

  .layout{ gap: 12px; }
  .topbar h1{ font-size: 18px; }
  .board-wrap{ gap: var(--wrap-gap); }

  .row select, .row input[type="range"]{ width: 160px; }
  .buttons{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; }
  .buttons button{ width:100%; }

  .moves{ max-height: 180px; }
}

@media (max-width: 420px){
  :root{
    --layout-hpad: 12px; /* iPhone SE等で少し余白を厚めに */
    --board-size: min(
      calc(100vw - (2 * var(--layout-hpad)) - var(--eval-w) - var(--wrap-gap)),
      420px
    );
  }
  .row label{ font-size: 13px; }
  .help{ font-size: 12px; }
  .topbar{ padding: 10px 12px; }
  .status{ font-size: 14px; }
  .badge{ font-size: 11px; }
  .row select, .row input[type="range"]{ width: 140px; }
  .buttons{ grid-template-columns: 1fr; }
}

@media (max-width: 360px){
  .board-wrap{ gap:6px; }
}
