/* ========= 基本トークン ========= */
:root{
  --bg:          light-dark(#fafafa, #0f1115);
  --card:        light-dark(#ffffff, #141820);
  --text:        light-dark(#111, #e9eef3);
  --muted:       light-dark(#5f6b7a, #9fb0c3);
  --accent:      #3b82f6;
  --accent-2:    #22c55e;
  --danger:      #ef4444;

  --board-green: #2f7d32;
  --board-dark:  #2a6b2c;

  /* 盤まわり（デスクトップのデフォルト） */
  --gap:         6px;
  --cell-size:   60px; /* 8*60 + 9*6 = 534px */
  --board-size:  calc(8*var(--cell-size) + 9*var(--gap));
}

*{ box-sizing: border-box; -webkit-tap-highlight-color: transparent }
html,body{ height: 100% }
body{
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
  background: var(--bg);
  color: var(--text);
}

/* ========= ヘッダ ========= */
.topbar{
  display:flex; align-items:center; justify-content:space-between;
  padding: 14px 16px; border-bottom: 1px solid color-mix(in oklab, var(--text) 12%, transparent);
  position: sticky; top:0; backdrop-filter: blur(8px);
}
.topbar h1{ margin:0; font-size: 22px; letter-spacing: .5px; }
.badges{ display:flex; gap:8px }
.badge{ font-size:12px; padding:2px 8px; border-radius:999px; background:color-mix(in oklab, var(--accent) 20%, transparent); }

/* ========= レイアウト ========= */
.layout{
  display:grid; grid-template-columns: 1fr 360px; gap: 18px; padding: 18px; max-width: 1200px; margin: 0 auto;
}
@media (max-width: 980px){
  .layout{ grid-template-columns: 1fr; padding: 14px; gap: 14px; }
}

.board-wrap{
  display:flex; gap:14px; align-items:flex-start; justify-content:center;
}

/* ========= 盤 ========= */
.board{
  display:grid;
  grid-template-columns: repeat(8, var(--cell-size));
  grid-auto-rows: var(--cell-size);
  gap: var(--gap);
  background: var(--board-green);
  padding: var(--gap);
  border-radius: 14px;
  box-shadow: inset 0 8px 32px rgba(0,0,0,.25), 0 14px 30px rgba(0,0,0,.15);
  width: max-content;
  touch-action: manipulation;
}

.cell{
  position: relative;
  width: var(--cell-size); height: var(--cell-size);
  background: var(--board-dark);
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,.08);
  cursor: pointer; outline: none;
  transition: transform .05s ease;
  min-width: 44px; min-height: 44px;
}
.cell:active{ transform: translateY(1px) }
.cell:focus-visible{ box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent) 40%, transparent) }

.stone{
  position:absolute; inset: 8px; border-radius:50%;
  box-shadow: 0 3px 8px rgba(0,0,0,.4), inset 0 2px 5px rgba(255,255,255,.18);
  transform: scale(.9); opacity: 0; animation: pop .12s ease forwards;
}
.stone.black{ background: #0e0f11; }
.stone.white{ background: #e9eef3; }

@keyframes pop{ to{ transform: scale(1); opacity: 1 } }

.hint{
  position:absolute; inset: calc(50% - 4px);
  width: 8px; height: 8px; border-radius:50%;
  background: rgba(255,255,255,.85);
  mix-blend-mode: difference; opacity:.55; pointer-events:none;
}

.lastmove{
  outline: 3px solid color-mix(in oklab, var(--accent-2) 60%, transparent);
  outline-offset: -3px;
}

/* ========= 評価バー（幅を自動拡張・数字が収まる） ========= */
.evalbar{
  /* デスクトップでは 52px、モバイルでは画面幅に応じて 40–56px にクランプ */
  --eval-w: 52px;
  position:relative; width: var(--eval-w);
  height: calc(8*var(--cell-size) + 2*var(--gap) + 2*var(--gap));
  border-radius: 10px; overflow:hidden; background: #111;
  box-shadow: inset 0 4px 14px rgba(0,0,0,.5);
}
#evalFill{
  position:absolute; left:0; bottom:0; width:100%; height:50%;
  background: linear-gradient(to top, #0e0f11, #4ade80);
  transition: height .2s ease;
}

/* ★ 数字ラベル（トップ=白、ボトム=黒） */
.evallabels{
  position:absolute; inset: 6px 4px; /* 横に余白を少し確保 */
  display:flex; flex-direction:column; justify-content:space-between; align-items:stretch;
  pointer-events:none;
  color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,.6);
  z-index: 1;  /* 数字をバーの上に表示 */
  /* バー幅に応じて文字サイズを自動調整（11–16px） */
  font-size: clamp(11px, calc(var(--eval-w) * 0.28), 16px);
}
.evallabels .label{
  display:flex; align-items:center; justify-content:space-between; gap:6px;
  width: 100%;
  white-space: nowrap;
}
.count{
  pointer-events:auto;
  padding: 2px 6px; border-radius: 999px; font-weight: 800;
  box-shadow: 0 1px 2px rgba(0,0,0,.4);
}
.count.white{ background:#e9eef3; color:#0e0f11; }
.count.black{ background:#0e0f11; color:#e9eef3; }

/* ========= 右サイド ========= */
.side{ display:flex; flex-direction:column; gap:14px; }

.status{
  padding: 10px 12px; border-radius: 12px;
  background: var(--card); border: 1px solid color-mix(in oklab, var(--text) 12%, transparent);
  font-weight: 600;
}

.card{
  background: var(--card);
  border: 1px solid color-mix(in oklab, var(--text) 12%, transparent);
  border-radius: 14px; padding: 12px;
  display:flex; flex-direction:column; gap:10px;
}

.row{ display:flex; gap:10px; align-items:center; justify-content:space-between; }
.row label{ font-size: 14px; color: var(--muted); }
.row select, .row input[type="range"]{ width: 180px; }
.toggles{ justify-content:flex-start; gap:18px; flex-wrap: wrap; }

.buttons{ display:flex; flex-wrap:wrap; gap:8px; }
button{
  appearance:none; border:none; border-radius: 10px; padding: 10px 14px;
  background: color-mix(in oklab, var(--accent) 20%, transparent);
  color: var(--text); cursor:pointer; font-weight:600;
  border:1px solid color-mix(in oklab, var(--accent) 35%, transparent);
  transition: transform .05s ease, background .2s ease;
  min-height: 44px;
}
button:hover{ transform: translateY(-1px) }
button:disabled{ opacity:.5; cursor:not-allowed; transform:none }
button.danger{
  background: color-mix(in oklab, var(--danger) 24%, transparent);
  border-color: color-mix(in oklab, var(--danger) 40%, transparent);
}

.help{ margin:0; color: var(--muted); font-size: 13px }
code{ background: color-mix(in oklab, var(--text) 10%, transparent); padding:2px 6px; border-radius:6px }

.moves{ margin:0; padding-left: 20px; max-height: 220px; overflow:auto; }
.moves li{ padding: 2px 0; color: var(--muted) }
.moves-actions{ display:flex; gap:8px }
.moves-actions button{ padding:6px 8px; font-size:13px }

.foot{ text-align:center; padding: 20px 10px; color: var(--muted) }

/* ========= スマホ最適化 ========= */
@media (max-width: 720px){
  :root{
    --gap: 4px;
    --board-size: min(92vw, 480px);
    --cell-size: calc((var(--board-size) - 9*var(--gap)) / 8);
  }
  .layout{ padding: 10px; gap: 12px; }
  .topbar h1{ font-size: 18px; }
  .board-wrap{ gap:8px; }

  /* モバイル時はバー幅を画面幅に応じて 40–56px にクランプ */
  .evalbar{ --eval-w: clamp(40px, 12vw, 56px); }

  .row select, .row input[type="range"]{ width: 160px; }
  .buttons{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; }
  .buttons button{ width:100%; }

  .moves{ max-height: 180px; }
}

@media (max-width: 420px){
  :root{ --board-size: min(94vw, 420px); }
  .row label{ font-size: 13px; }
  .help{ font-size: 12px; }
  .topbar{ padding: 10px 12px; }
  .status{ font-size: 14px; }
  .badge{ font-size: 11px; }
  .row select, .row input[type="range"]{ width: 140px; }
  .buttons{ grid-template-columns: 1fr; }
}

@media (max-width: 360px){
  .board-wrap{ gap:6px; }
}
