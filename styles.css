/* ========= 基本トークン ========= */
:root{
  --bg:          light-dark(#fafafa, #0f1115);
  --card:        light-dark(#ffffff, #141820);
  --text:        light-dark(#111, #e9eef3);
  --muted:       light-dark(#5f6b7a, #9fb0c3);
  --accent:      #3b82f6;
  --accent-2:    #22c55e;
  --danger:      #ef4444;

  --board-green: #2f7d32;
  --board-dark:  #2a6b2c;

  --eval-w:      52px;   /* デスクトップ：縦バーの幅 */
  --layout-hpad: 18px;

  /* 盤サイズ（デスクトップ初期値：モバイルで再計算） */
  --gap:         6px;
  --board-size:  534px;
}

*{ box-sizing: border-box; -webkit-tap-highlight-color: transparent }
html,body{ height: 100% }
body{
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
  background: var(--bg);
  color: var(--text);
  overflow-x: hidden;
}

/* ========= ヘッダ ========= */
.topbar{
  display:flex; align-items:center; justify-content:space-between;
  padding: 14px 16px; border-bottom: 1px solid color-mix(in oklab, var(--text) 12%, transparent);
  position: sticky; top:0; backdrop-filter: blur(8px);
}
.topbar h1{ margin:0; font-size: 22px; letter-spacing: .5px; }
.badges{ display:flex; gap:8px }
.badge{ font-size:12px; padding:2px 8px; border-radius:999px; background:color-mix(in oklab, var(--accent) 20%, transparent); }

/* ========= レイアウト ========= */
.layout{
  display:grid; grid-template-columns: 1fr 360px; gap: 18px;
  padding: 18px var(--layout-hpad);
  max-width: 1200px; margin: 0 auto;
}
@media (max-width: 980px){
  .layout{ grid-template-columns: 1fr; gap: 14px; }
}
@supports (padding: max(0px)){
  .layout{
    padding-left:  max(var(--layout-hpad), env(safe-area-inset-left));
    padding-right: max(var(--layout-hpad), env(safe-area-inset-right));
  }
}

/* 盤＋バーの並び（PCは横並び、スマホは縦積み） */
.board-wrap{
  display:flex; gap:14px; align-items:flex-start; justify-content:center;
}

/* ========= 盤とラッパ ========= */
.board-box{ position: relative; width: max-content; height: max-content; }

/* 盤は常に正方形 */
.board{
  width: var(--board-size);
  height: var(--board-size);
  display:grid;
  grid-template-columns: repeat(8, 1fr);
  grid-auto-rows: 1fr;
  gap: var(--gap);
  padding: var(--gap);
  background: var(--board-green);
  border-radius: 14px;
  overflow: hidden;
  background-clip: padding-box;
  isolation: isolate;
  box-shadow: inset 0 8px 32px rgba(0,0,0,.25), 0 14px 30px rgba(0,0,0,.15);
  touch-action: manipulation;
}

.cell{
  position: relative;
  background: var(--board-dark);
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,.08);
  cursor: pointer; outline: none;
  transition: transform .05s ease;
  place-self: stretch;
}
.cell:active{ transform: translateY(1px) }
.cell:focus-visible{ box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent) 40%, transparent) }

.stone{
  position:absolute; inset: clamp(4px, calc(var(--gap) + 2px), 10px);
  border-radius:50%;
  box-shadow: 0 3px 8px rgba(0,0,0,.4), inset 0 2px 5px rgba(255,255,255,.18);
  transform: scale(.9); opacity: 0; animation: pop .12s ease forwards;
}
.stone.black{ background: #0e0f11; }
.stone.white{ background: #e9eef3; }
@keyframes pop{ to{ transform: scale(1); opacity: 1 } }

.hint{
  position:absolute; inset: calc(50% - 4px);
  width: 8px; height: 8px; border-radius:50%;
  background: rgba(255,255,255,.85);
  mix-blend-mode: difference; opacity:.55; pointer-events:none;
}
.lastmove{ outline: 3px solid color-mix(in oklab, var(--accent-2) 60%, transparent); outline-offset: -3px; }

/* ========= 評価バー（PC：縦／スマホ：横） ========= */
/* PC（縦）：左側に配置 */
.evalbar{
  position:relative; width: var(--eval-w);
  height: var(--board-size);
  border-radius: 10px; overflow:hidden;
  background: #ffffff;/* 上が白 */
  border: 1px solid color-mix(in oklab, var(--text) 30%, transparent);
  box-shadow: inset 0 4px 14px rgba(0,0,0,.35);
}
#evalFill{
  position:absolute; left:0; bottom:0; width:100%; height:50%;
  background: #0e0f11;          /* 下が黒（=黒石の割合） */
  transition: width .2s ease, height .2s ease;
}

/* 数字バッジ */
.evallabels{
  position:absolute; inset: 6px 4px;
  display:flex; flex-direction:column; justify-content:space-between; align-items:center;
  pointer-events:none; color:#fff; text-shadow:0 1px 2px rgba(0,0,0,.6);
  z-index:1; font-size: clamp(11px, calc(var(--eval-w) * 0.28), 16px);
}
.evallabels .label{ display:flex; align-items:center; justify-content:center; gap:6px; width:100%; }
.count{
  pointer-events:auto; padding: 2px 6px; border-radius: 999px; font-weight: 800; line-height: 1;
  box-shadow: 0 1px 2px rgba(0,0,0,.4);
}
.count.white{ background:#e9eef3; color:#0e0f11; border:1px solid rgba(0,0,0,.08); }
.count.black{ background:#0e0f11; color:#e9eef3; border:1px solid rgba(255,255,255,.25); }

/* ========= 右サイド ========= */
.side{ display:flex; flex-direction:column; gap:14px; }
.status{
  padding: 10px 12px; border-radius: 12px;
  background: var(--card); border: 1px solid color-mix(in oklab, var(--text) 12%, transparent);
  font-weight: 600;
}
.card{
  background: var(--card);
  border: 1px solid color-mix(in oklab, var(--text) 12%, transparent);
  border-radius: 14px; padding: 12px;
  display:flex; flex-direction:column; gap:10px;
}
.row{ display:flex; gap:10px; align-items:center; justify-content:space-between; }
.row label{ font-size: 14px; color: var(--muted); }
.row select, .row input[type="range"]{ width: 180px; }
.toggles{ justify-content:flex-start; gap:18px; flex-wrap: wrap; }

.buttons{ display:flex; flex-wrap:wrap; gap:8px; }
button{
  appearance:none; border:none; border-radius: 10px; padding: 10px 14px;
  background: color-mix(in oklab, var(--accent) 20%, transparent);
  color: var(--text); cursor:pointer; font-weight:600;
  border:1px solid color-mix(in oklab, var(--accent) 35%, transparent);
  transition: transform .05s ease, background .2s ease;
  min-height: 44px;
}
button:hover{ transform: translateY(-1px) }
button:disabled{ opacity:.5; cursor:not-allowed; transform:none }
button.danger{
  background: color-mix(in oklab, var(--danger) 24%, transparent);
  border-color: color-mix(in oklab, var(--danger) 40%, transparent);
}
.help{ margin:0; color: var(--muted); font-size: 13px }
code{ background: color-mix(in oklab, var(--text) 10%, transparent); padding:2px 6px; border-radius:6px }
.moves{ margin:0; padding-left: 20px; max-height: 220px; overflow:auto; }
.moves li{ padding: 2px 0; color: var(--muted) }
.moves-actions{ display:flex; gap:8px }
.moves-actions button{ padding:6px 8px; font-size:13px }
.foot{ text-align:center; padding: 20px 10px; color: var(--muted) }

/* ========= スマホ最適化（右余白＋横バー） ========= */
@media (max-width: 720px){
  :root{
    --layout-hpad: 10px;
    --wrap-gap: 8px;

    /* 盤サイズの計算（右余白を保ちつつ最大化） */
    --gap: 4px;
    --min-cell: 40px;
    --eval-h: clamp(28px, 6vw, 46px); /* 横バーの高さ */
    /* スマホではバーは上に乗るので、幅は盤と同じ・高さは --eval-h */
    --board-size-limit: calc(100vw - (2 * var(--layout-hpad)));
    --board-size-min: calc(9 * var(--gap) + 8 * var(--min-cell));
    --board-size: min(max(var(--board-size-min), var(--board-size-limit)), 520px);
  }

  /* 縦積み：上に横バー、下に盤 */
  .board-wrap{
    flex-direction: column;
    align-items: center;
    gap: 10px;
  }

  /* 横バーにスタイル切り替え */
  .evalbar{
    width: var(--board-size);
    height: var(--eval-h);
    background: #ffffff;                       /* 左が白 */
    border: 1px solid color-mix(in oklab, var(--text) 30%, transparent);
    box-shadow: inset 0 4px 14px rgba(0,0,0,.35);
  }
  #evalFill{
    left:0; top:0; height:100%; width:50%;     /* ← JS側で width を%更新 */
    background: #0e0f11;                       /* 右側が白、左が黒 */
  }

  /* 数字は左右に配置（左=黒 / 右=白） */
  .evallabels{
    inset: 4px 6px;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    font-size: clamp(11px, calc(var(--eval-h) * 0.45), 16px);
  }
  .evallabels .top{ order: 2; }    /* 右側（白） */
  .evallabels .bottom{ order: 1; } /* 左側（黒） */

  /* 盤の横幅は画面幅にフィット（バーと同じ） */
  .board{
    width: var(--board-size);
    height: var(--board-size);
  }

  .row select, .row input[type="range"]{ width: 160px; }
  .buttons{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; }
  .buttons button{ width:100%; }
  .moves{ max-height: 180px; }
}

@media (max-width: 420px){
  :root{ --layout-hpad: 12px; }
  .row label{ font-size: 13px; }
  .help{ font-size: 12px; }
  .topbar{ padding: 10px 12px; }
  .status{ font-size: 14px; }
  .badge{ font-size: 11px; }
  .row select, .row input[type="range"]{ width: 140px; }
  .buttons{ grid-template-columns: 1fr; }
}
@media (max-width: 360px){
  .board-wrap{ gap:6px; }
}
